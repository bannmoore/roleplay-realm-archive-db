#!/bin/bash
set -euo pipefail
IFS=$'\n\t'

COMMAND=( "${@:-up}" )

echo $DATABASE_URL

function get_db_url() {
  if [ -z "${DATABASE_URL:-}" ]; then
    # echo "postgres://postgres:password@$(docker compose port postgres 5432)/postgres?sslmode=disable"
    echo "postgres://postgres:password@0.0.0.0:5432/postgres?sslmode=disable"
  else
    echo $DATABASE_URL
  fi
}

echo "$(get_db_url)"

goose -dir migrations postgres "$(get_db_url)" "${COMMAND[@]}"